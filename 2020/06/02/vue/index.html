<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="https://fonts.loli.net/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="vue," />





  <link rel="alternate" href="/atom.xml" title="小飒的博客" type="application/atom+xml" />






<meta name="description" content="关于vue的内部原理其实有很多个重要的部分，变化侦测，模板编译，virtualDOM，整体运行流程等">
<meta property="og:type" content="article">
<meta property="og:title" content="vue">
<meta property="og:url" content="http://yoursite.com/2020/06/02/vue/index.html">
<meta property="og:site_name" content="小飒的博客">
<meta property="og:description" content="关于vue的内部原理其实有很多个重要的部分，变化侦测，模板编译，virtualDOM，整体运行流程等">
<meta property="og:image" content="http://yoursite.com/2020/06/02/vue/1.png">
<meta property="og:image" content="http://yoursite.com/2020/06/02/vue/2.PNG">
<meta property="og:image" content="http://yoursite.com/2020/06/02/vue/3.png">
<meta property="article:published_time" content="2020-06-02T07:36:01.000Z">
<meta property="article:modified_time" content="2020-06-20T03:42:23.466Z">
<meta property="article:author" content="小飒">
<meta property="article:tag" content="vue">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2020/06/02/vue/1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/06/02/vue/"/>





  <title>vue | 小飒的博客</title>
  








<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
	<a href="https://github.com/quansa" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
   <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta custom-logo">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">小飒的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home                          //首页"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive          //归档"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th           //分类"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags                     //标签"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user                   //关于"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/02/vue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小飒">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小飒的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">vue</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-06-02T15:36:01+08:00">
                2020-06-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index">
                    <span itemprop="name">web前端</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%89%8D%E7%AB%AF/vue/" itemprop="url" rel="index">
                    <span itemprop="name">vue</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>关于vue的内部原理其实有很多个重要的部分，变化侦测，模板编译，virtualDOM，整体运行流程等</p>
<a id="more"></a>

<h1 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h1><p>M（model数据模型），V（view视图），C（Controller控制器，ViewController）映射到前端就是</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--view--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">'test'</span>&gt;</span></span><br><span class="line">			view</span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">		<span class="comment">// model</span></span></span><br><span class="line"><span class="actionscript">		<span class="function"><span class="keyword">function</span> <span class="title">ajaxData</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">			<span class="comment">// 获取后台数据data</span></span></span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line"><span class="actionscript">		<span class="comment">// 处理各种逻辑和数据转化</span></span></span><br><span class="line"><span class="actionscript">		<span class="comment">// Controller</span></span></span><br><span class="line"><span class="javascript">		<span class="keyword">let</span> test = <span class="built_in">document</span>.getElementById(<span class="string">'test'</span>)</span></span><br><span class="line">		test.innerHTML  = data.test</span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>MVC理想状态下：后台传回的数据改变，页面上的展示也改变</p>
<h1 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h1><p>M（model数据模型），VM（View-Model），V（view视图）<br>MVVM是MVC的改进，复杂的业务逻辑使得Contrller太过庞大，所以将Contrller一部分逻辑处理部分抽取出来，由View-Model对象去管理。VM是Model与Controller的桥梁<br>（View中每一个UI元素在VM中都有相对应的属性，从controller中抽离出来与UI有关的逻辑放在VM中）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--view--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">'app'</span>&gt;</span>view<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">	<span class="comment">// model</span></span></span><br><span class="line"><span class="javascript">	<span class="keyword">let</span> data = &#123;&#125;</span></span><br><span class="line">	</span><br><span class="line"><span class="actionscript">	<span class="comment">// view-model</span></span></span><br><span class="line"><span class="javascript">	<span class="keyword">let</span> vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="actionscript">		el: <span class="string">'#app'</span>,</span></span><br><span class="line">		data: data,</span><br><span class="line">		methods: &#123;&#125;</span><br><span class="line">	&#125;) </span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>vue.js的实现方法是数据劫持<br>    响应式流程：观察者模式<br>Object.defineProperty()方法对Vue中data里的属性进行劫持，被劫持的属性会有相应的get,set方法，属性值改变触发set方法，通知watcher<br>observer<br>watcher<br>dep</p>
<p>MVVM<br><img src="/2020/06/02/vue/1.png" alt="enter description here"></p>
<p>MVVM<br><img src="/2020/06/02/vue/2.PNG" alt="enter description here"></p>
<p>响应数据图解<br><img src="/2020/06/02/vue/3.png" alt="enter description here"></p>
<h1 id="渲染方式"><a href="#渲染方式" class="headerlink" title="渲染方式"></a>渲染方式</h1><p>官方脚手架就是采用该渲染方式：<br>使用render属性，配合单文件组件，createElement函数渲染。</p>
<h1 id="异步更新DOM"><a href="#异步更新DOM" class="headerlink" title="异步更新DOM"></a>异步更新DOM</h1><p>场景：当我们改变状态后，想要获取改变后的DOM，得到的是改变前的DOM,所以要用到vm.$nextTick()，异步获取DOM<br>渲染操作推迟到本轮事件循环的最后，等前面的更新状态的语句都执行完之后，执行一次渲染<br>vue的变化侦测机制决定，每一次状态发生变化都会发出渲染的信号，vue在收到信号之后检查队列中是否存在任务，之后通过异步延迟执行队列中所有的渲染操作，清空队列</p>
<h2 id="事件循环机制"><a href="#事件循环机制" class="headerlink" title="事件循环机制"></a>事件循环机制</h2><p>函数调用时创建执行环境并压栈，<br>同步事件压栈，异步事件入队列等待执行</p>
<h3 id="微任务"><a href="#微任务" class="headerlink" title="微任务"></a>微任务</h3><p>当栈空去微任务队列拿出任务开始执行<br>Promise.then<br>Object.observer<br>process.nextTick</p>
<h3 id="宏任务"><a href="#宏任务" class="headerlink" title="宏任务"></a>宏任务</h3><p>当微任务队列空之后从宏任务队列拿出一个任务执行，执行完毕后，再去检查微任务队列，微任务队列空，再去宏任务，===》<strong>事件循环机制</strong><br>setTimeout<br>setInterval<br>MutationObserver 监听DOM改动</p>
<h3 id="nextTick原理"><a href="#nextTick原理" class="headerlink" title="nextTick原理"></a>nextTick原理</h3><p>vue进行DOM更新内部也是调用nextTick来做异步队列控制。而当我们自己调用nextTick的时候，它就在更新DOM的那个微任务后追加了我们自己的回调函数，从而确保我们的代码在DOM更新后执行，</p>
<h1 id="动态和异步组件"><a href="#动态和异步组件" class="headerlink" title="动态和异步组件"></a>动态和异步组件</h1><p>实现前端模块化，并能按照权重的优先级顺序异步加载</p>
<h2 id="动态组件"><a href="#动态组件" class="headerlink" title="动态组件"></a>动态组件</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">component</span> <span class="attr">v-bind:is</span>=<span class="string">"currentTabComponent"</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 失活的组件将会被缓存！--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">component</span> <span class="attr">v-bind:is</span>=<span class="string">"currentTabComponent"</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="keep-alive"><a href="#keep-alive" class="headerlink" title="keep-alive"></a>keep-alive</h2><p><keep-alive>包裹动态组件时，会缓存不活动的组件实例（缓存在内存中），他是一个抽象组件，自身不会渲染一个DOM元素，也不会在组建的父组件链中</keep-alive></p>
<p>当组件被切换时，不会触发created钩子，触发activated和deactivated生命周期来得知组件是否处于活动状态</p>
<p>include,exclude   允许组件有条件的缓存</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--缓存child1组件---&gt;</span></span><br><span class="line"><span class="comment">&lt;!--字符串，隔开，或者表达式，或者数组---&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">include</span>=<span class="string">'child1'</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">child1</span>&gt;</span><span class="tag">&lt;/<span class="name">child1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--除了child1组件，缓存其他组件---&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">exclude</span>=<span class="string">'child1'</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">child1</span>&gt;</span><span class="tag">&lt;/<span class="name">child1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>max</p>
<p>最大缓存多少个组件，大于后，在新实例被创建之前，已缓存组件中最久没有被访问的实例会被销毁掉。</p>
<p>原理：</p>
<p>1.获取keep-alive包裹的第一个子组件对象及组件名</p>
<p>​    根据设定的include/exclude进行匹配，决定是否缓存，不匹配直接返回组件实例</p>
<p>2.根据组件ID,tag生成缓存key值，并在缓存对象中查找是否缓存过，如果存在，直接取出缓存并更新key值（更新key值是为了实现LRU置换策略的关键）</p>
<p>3.在this.cache对象中缓存该组件并保存key,之后检查缓存实例数量是否超过max,超过则删除最久没有使用的实例（下表为0的key值）</p>
<h2 id="异步组件"><a href="#异步组件" class="headerlink" title="异步组件"></a>异步组件</h2><p>异步组件就是定义的时候什么都不做，只在组件需要渲染（组件第一次显示）的时候进行加载渲染并缓存，缓存是以备下次访问。</p>
<p>Vue 允许你以一个工厂函数的方式定义你的组件，这个工厂函数会异步解析你的组件定义</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Vue.component(<span class="string">'async-example'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</span><br><span class="line">     setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 向 `resolve` 回调传递组件定义</span></span><br><span class="line">    resolve(&#123;</span><br><span class="line">      template: <span class="string">'&lt;div&gt;I am async!&lt;/div&gt;'</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回一个Promise对象</span></span><br><span class="line">Vue.component(</span><br><span class="line">  <span class="string">'async-webpack-example'</span>,</span><br><span class="line">  <span class="comment">// 这个动态导入会返回一个 `Promise` 对象。</span></span><br><span class="line">  () =&gt; <span class="keyword">import</span>(<span class="string">'./my-async-component'</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//高级异步组件</span></span><br><span class="line"><span class="comment">//解决：异步加载，存在加载过程（正在加载中）、以及加载失败等异常情况。</span></span><br><span class="line"><span class="comment">//返回对象</span></span><br><span class="line"><span class="keyword">const</span> AsyncComponent = <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">  <span class="comment">// 需要加载的组件 (应该是一个 `Promise` 对象)</span></span><br><span class="line">  component: <span class="keyword">import</span>(<span class="string">'./MyComponent.vue'</span>),</span><br><span class="line">  <span class="comment">// 异步组件加载时使用的组件</span></span><br><span class="line">  loading: LoadingComponent,</span><br><span class="line">  <span class="comment">// 加载失败时使用的组件</span></span><br><span class="line">  error: ErrorComponent,</span><br><span class="line">  <span class="comment">// 展示加载时组件的延时时间。默认值是 200 (毫秒)</span></span><br><span class="line">  delay: <span class="number">200</span>,</span><br><span class="line">  <span class="comment">// 如果提供了超时时间且组件加载也超时了，</span></span><br><span class="line">  <span class="comment">// 则使用加载失败时使用的组件。默认值是：`Infinity`</span></span><br><span class="line">  timeout: <span class="number">3000</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="按需加载"><a href="#按需加载" class="headerlink" title="按需加载"></a>按需加载</h2><p>Vue实现按需加载，官方推荐使用结合webpack的代码分割功能进行。定义为异步加载的组件，在打包的时候，会打包成单独的js文件存储在static/js文件夹里面，在调用时使用ajax请求回来插入到html中。</p>
<h2 id="webpack代码分割"><a href="#webpack代码分割" class="headerlink" title="webpack代码分割"></a>webpack代码分割</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ChildComponent = <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/componets/ChildComponent'</span>)</span><br><span class="line"><span class="comment">//在配置路由时直接调用</span></span><br><span class="line">&#123;</span><br><span class="line">    path:<span class="string">'/'</span>,</span><br><span class="line">    name:<span class="string">'ChildComponent'</span>,</span><br><span class="line">    component: ChildComponent</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//推荐使用</span></span><br><span class="line">&#123;</span><br><span class="line">    path:<span class="string">'/'</span>,</span><br><span class="line">    name:<span class="string">'ChildComponent'</span>,</span><br><span class="line">    <span class="comment">// require.ensure为webpack代码分割的方法</span></span><br><span class="line">    component: <span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">require</span>.ensure([],() =&gt; resolve(<span class="built_in">require</span>(../componets/ChildComponent)),<span class="string">'ChildComponent'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>结合 Vue 的异步组件和 Webpack 的代码分割功能，在 vue-router 中，我们轻松实现了路由组件的按需加载加载。所以，文章开头的问题在这里就可以解答了。以0-7数字开头的 js 文件，就是每个路由对应的组件构建出来的 bundle。只有用户访问对应的路由时，才会加载相应的 bundle， <strong>提高页面加载效率</strong> 。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">'/login'</span>, <span class="attr">component</span>: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/login'</span>), &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">'/home'</span>, <span class="attr">component</span>: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/home'</span>), &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>









<h1 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h1><p><strong>组件实例化，组件更新，组件摧毁</strong></p>
<p>beforeCreate   new Vue()之后，数据还没挂载，只是空壳子<br>created             实例化完成后调用，数据观测，属性和方法的运算，watch/event事件毁掉完成，这个时候可以使用数据了，可以更新数据，不会触发updated</p>
<table>
<thead>
<tr>
<th>钩子</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>beforeCreate</td>
<td>new VUe()之后，数据还没挂载，空壳子</td>
</tr>
<tr>
<td>created</td>
<td>实例化完成调用，数据观测，属性，方法，watch/event事件回到已完成，还没有挂载$el属性还没有 ，这是时候有数据了，可以更新数据，但不会触发updated，一般做初始数据获取，如ajax</td>
</tr>
<tr>
<td>beforeMount</td>
<td>开始挂载之前调用，相关的render函数首次被调用，此时DOM是数据挂在前的DOM，数据还未挂载，这里虚拟DOM已经创建完成，可以更改数据，不会触发updated</td>
</tr>
<tr>
<td>mounted</td>
<td>数据已挂在后调用，初始化的el被$el代替，并挂载到实例上去之后的钩子 ,此时组件出现在页面上，数据，真实DOM已处理好，事件已挂载好，可以操作真实DOM</td>
</tr>
<tr>
<td>beforeUpdata</td>
<td>数据更新时调用，发生在虚拟DOM重新渲染和打补丁之前，不可更改数据，陷入死循环，vue虚拟DOM机制会重新构建，与上次虚拟DOM对比之后重新渲染</td>
</tr>
<tr>
<td>updated</td>
<td>在数据驱动下导致虚拟DOM重新渲染之后调用，DOM已更新</td>
</tr>
<tr>
<td>activated</td>
<td>keep-alive组件激活时调用，若使用keep-alive进行缓存，又希望每次切换组件时更新数据，更新数据的方法在此钩子里</td>
</tr>
<tr>
<td>deactivated</td>
<td>keep-alive组件停用时调用</td>
</tr>
<tr>
<td>beforeDestroy</td>
<td>实例摧毁之前调用，此实例还可以用 ，清除计时器、清除非指令绑定的事件等等</td>
</tr>
<tr>
<td>destroyed</td>
<td>实例摧毁之后调用，实例指示的所有东西都会解绑定，所有的事件监听器会被移除，所有的子实例也会被销毁</td>
</tr>
</tbody></table>
<h2 id><a href="#" class="headerlink" title></a></h2><h2 id="ajax在那个生命周期"><a href="#ajax在那个生命周期" class="headerlink" title="ajax在那个生命周期"></a>ajax在那个生命周期</h2><p>created,beforeMount<br>1.调用created钩子时，数据已挂在完成，可以再次更新数据，并不会触发别的钩子，<br>2.父子组件中，先创建父组件，在创建并挂在子组件，再挂在父组件，如果子组件要用到父组件的数据，</p>
<h2 id="父子组件生命周期调用顺序"><a href="#父子组件生命周期调用顺序" class="headerlink" title="父子组件生命周期调用顺序"></a>父子组件生命周期调用顺序</h2><p>1.先创建父组件beforeCreate,created,beforeMount<br>2.再创建并挂载子组件beforeCreate,created，beforeMount，mounted<br>3.再挂在父组件mounted</p>
<h1 id="计算属性，侦听属性"><a href="#计算属性，侦听属性" class="headerlink" title="计算属性，侦听属性"></a>计算属性，侦听属性</h1><h2 id="计算属性"><a href="#计算属性" class="headerlink" title="计算属性"></a>计算属性</h2><p>自动监听依赖值的变化，动态返回内容。特点：<br>1.数据可以惊醒逻辑处理，减少末班中的计算逻辑<br>2.对计算属性中的数据进行监视<br>3.依赖固定的数据类型（响应式数据）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方法一</span></span><br><span class="line">computed: &#123;</span><br><span class="line">	fullName : &#123;</span><br><span class="line">		<span class="comment">// getter默认</span></span><br><span class="line">		<span class="keyword">get</span>: function()&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">this</span>.firstName + <span class="string">' '</span>  + <span class="keyword">this</span>.lastName</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="comment">// 需要时，自己添加，不能直接修改计算属性的值，而是修改依赖值</span></span><br><span class="line">		<span class="keyword">set</span>: funtion(newValue)&#123;</span><br><span class="line">		<span class="comment">// this.fullName = newValue 这种写法会报错</span></span><br><span class="line">		 <span class="keyword">var</span> names = newValue.split(<span class="string">' '</span>)</span><br><span class="line">     	 <span class="keyword">this</span>.firstName = names[<span class="number">0</span>] <span class="comment">// 对它的依赖进行赋值</span></span><br><span class="line">      	 <span class="keyword">this</span>.lastName = names[names.length - <span class="number">1</span>]</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">运行vm.fullName = 'quan sa'时，调用set</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法二</span></span><br><span class="line">data()&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		msg: <span class="string">'hahaha xixixi'</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;,</span><br><span class="line">computed: &#123;</span><br><span class="line">	<span class="comment">// 计算属性值为函数</span></span><br><span class="line">	<span class="comment">//函数必须有返回值，来获取属性，get函数</span></span><br><span class="line">	msg1:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">'hahaha'</span> </span><br><span class="line">	&#125;，</span><br><span class="line">	reverseMsg:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  		<span class="comment">//可以包含逻辑处理操作，同时reverseMsg依赖于msg,一旦msg发生变化，reverseMsg也会跟着变化</span></span><br><span class="line">    	<span class="keyword">return</span> <span class="keyword">this</span>.msg.split(<span class="string">' '</span>).reverse().join(<span class="string">' '</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="侦听属性"><a href="#侦听属性" class="headerlink" title="侦听属性"></a>侦听属性</h2><p>watch，可以执行任何逻辑（函数节流，ajax一步获取数据，DOM操作&lt;不建议&gt;）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">data()&#123;</span><br><span class="line">	<span class="keyword">return</span>&#123;</span><br><span class="line">		a: <span class="number">1</span>,</span><br><span class="line">      	b: &#123; <span class="attr">c</span>: <span class="number">2</span>, <span class="attr">d</span>: <span class="number">3</span> &#125;,</span><br><span class="line">      	e: &#123;</span><br><span class="line">       	 	f: &#123;</span><br><span class="line">          		g: <span class="number">4</span></span><br><span class="line">       	 		&#125;</span><br><span class="line">     	 	&#125;,</span><br><span class="line">     	 h: []</span><br><span class="line">	&#125;</span><br><span class="line">&#125;,</span><br><span class="line">watch:&#123;</span><br><span class="line">	a:<span class="function"><span class="keyword">function</span>(<span class="params">newVal,oldVal</span>)</span>&#123;</span><br><span class="line">	</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="string">"b.c"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">newVal,oldVal</span>)</span>&#123;</span><br><span class="line">	</span><br><span class="line">	&#125;,</span><br><span class="line">	e: &#123;</span><br><span class="line">	  <span class="comment">// handler()回调</span></span><br><span class="line">      handler: <span class="function"><span class="keyword">function</span>(<span class="params">val, oldVal</span>) </span>&#123;</span><br><span class="line">        </span><br><span class="line">      &#125;,</span><br><span class="line">      deep: <span class="literal">true</span>,  <span class="comment">// 用于监听e对象内部值的变化</span></span><br><span class="line">	  immediate: <span class="literal">true</span> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">deep: 用于监听对象内部值得变化</span></span><br><span class="line"><span class="comment">immediate：创建组件时立马执行一次handler回调</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h2 id="两者区别"><a href="#两者区别" class="headerlink" title="两者区别"></a>两者区别</h2><p>watch监听属性值，属性值变，触发回调<br>computed:监听依赖值，不变读取缓存，变重新计算<br><strong>computed不能执行异步任务，watch也可以检测computed属性</strong></p>
<p>利用watch实现防抖</p>
<h1 id="事件绑定原理"><a href="#事件绑定原理" class="headerlink" title="事件绑定原理"></a>事件绑定原理</h1><p>（DOM事件，vue自定义事件）<br>    1.在模板中v-on指令绑定DOM事件<br>        采用addEventListener实现<br>    2.在模板中v-on指令绑定自定义事件<br>    3.在vue options中通过events绑定自定义事件<br>    4.通过$on方法绑定自定义事件<br>    在编译阶段对v-on/@进行指令编译</p>
<h1 id="使用-v-html指令问题"><a href="#使用-v-html指令问题" class="headerlink" title="使用 v-html指令问题"></a>使用 v-html指令问题</h1><p>最终调用的是innerHTML方法<br>1.XSS攻击<br>        解决：引入xss包并挂载在vue原型上，<br>2.在单文件组件里，scoped样式不会应用到v-html上，因为那部分 HTML 没有被 Vue 的模板编译器处理</p>
<h1 id="v-if-v-for"><a href="#v-if-v-for" class="headerlink" title="v-if v-for"></a>v-if v-for</h1><h2 id="两者不可一起使用"><a href="#两者不可一起使用" class="headerlink" title="两者不可一起使用"></a>两者不可一起使用</h2><p>不可一起使用，v-for优先级高于v-if,如下代码，v-for每次都会执行v-if,造成不必要的计算，影响性能<br>即使users里有一个isActive=true，也会循环真个数组</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"user in users"</span> <span class="attr">v-if</span>=<span class="string">"user.isActive"</span> <span class="attr">:key</span>=<span class="string">"user.id"</span>&gt;</span></span><br><span class="line">      &#123;&#123; user.name &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解决方案</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/*将isActive为false的过滤出去*/</span><br><span class="line">computed:&#123;</span><br><span class="line">activeUsers:function()&#123;</span><br><span class="line">return this.users.filter(user=&gt;user.isActive)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"user in users"</span>  <span class="attr">:key</span>=<span class="string">"user.id"</span>&gt;</span></span><br><span class="line">      &#123;&#123; user.name &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="v-for-key"><a href="#v-for-key" class="headerlink" title="v-for key"></a>v-for key</h2><p>v-for中的key来给每个节点做一个唯一的标识，diff算法就可以正确的识别此节点，找到正确的位置区插入新的节点；key的主要作用是为了高效的更新虚拟dom，另外vue在使用相同标签名元素的过渡切换时，也会使用到key属性，目的是让vue可以区分它们，否则vue只会替换其内部属性而不会触发过渡效果。<br>2.高效更新虚拟DOM<br>3.一般用唯一值去定义key值，<br>        v-for更新渲染列表默认是就地复用，列表数据修改，会根据key值去判断某个值是否修改，修改则重新渲染，否则服用之前元素<br>        用index作为key值，在列表中间插入值后导致，插入位置和之后位置的元素都要更新</p>
<h1 id="v-model"><a href="#v-model" class="headerlink" title="v-model"></a>v-model</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">"sth"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">:value</span>=<span class="string">"sth"</span> @<span class="attr">input</span>=<span class="string">"sth = $event.target.value"</span> /&gt;</span></span><br><span class="line">// input事件，每个输入框内容发生变化，就会触发input事件，把新的value赋值给sth</span><br></pre></td></tr></table></figure>
<p>v-model 包含两部分内容：<br>1.value 作为元素的属性，<br>2.把 input 事件作为实时传递 value 的触发事件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--父组件引入子组件child--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">child</span> <span class="attr">v-model</span>=<span class="string">'price'</span>&gt;</span><span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  data() &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line">      price: 100,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--子组件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag"><span class="attr">:value</span>=<span class="string">'value'</span></span></span><br><span class="line"><span class="tag">@<span class="attr">input</span>=<span class="string">"$emit('input',$event.target.value)"</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript"><span class="comment">// v-model：父组件传给子组件的值</span></span></span><br><span class="line">  props: &#123;</span><br><span class="line"><span class="javascript">    value: <span class="built_in">String</span>,  </span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="组件之间的通信"><a href="#组件之间的通信" class="headerlink" title="组件之间的通信"></a>组件之间的通信</h1><h2 id="props"><a href="#props" class="headerlink" title="props"></a>props</h2><p>父组件传给子组件<br><strong>组件中的数据共有三种：data,props，computed</strong></p>
<h2 id="emit"><a href="#emit" class="headerlink" title="$emit"></a>$emit</h2><p>子组件向父组件传值通过事件形式)</p>
<h2 id="emit-on"><a href="#emit-on" class="headerlink" title="$emit/$on"></a>$emit/$on</h2><p>Bus<br>任意组件之间传值（项目较大时，使用vuex）<br>通过一个空的Vue实例作为中央事件总线（事件中心），用它来触发，监听事件</p>
<pre><code>将空Vue实例挂载在Vue.prototype
    var Bus=new Vue()
    Vue.prototype.Bus = Bus
在传值的组件里，this.Bus.$emit(&apos;data-a&apos;,this.name) 分发事件
在接受值得组件在mounted,created中监听事件，this.Bus.$on(&apos;data-a&apos;,name=&gt;{})监听事件
在beforeDestroy取消监听事件this.Bus.$off(&apos;data-a&apos;)取消监听事件</code></pre><h2 id="vuex"><a href="#vuex" class="headerlink" title="vuex"></a>vuex</h2><p>单项数据流</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>在全局拥有一个State存放数据，当组件要更新State中的数据是，要通过Mutation进行，档有一异步操作（调用后台接口更新数据时）或批量同步操作需要走Action，Action无法直接修改State，需要Mutation来修改State数据，更具State变化更新视图<br>store （仓库）<br>state（状态）<br>mutation（commit提交）<br>actions<br>module</p>
<h2 id="parent-children"><a href="#parent-children" class="headerlink" title="$parent / $children"></a>$parent / $children</h2><h2 id="attrs-listeners"><a href="#attrs-listeners" class="headerlink" title="$attrs/$listeners"></a>$attrs/$listeners</h2><p>用于父传子组件或孙组件</p>
<pre><code>$attrs：继承了所有父组件属性（除了prop传递的属性，class，style）
inheritAttrs：默认为true，继承所有父组件属性（除了prop传递的属性）作为普通的HTML特性应用在子组件根元素        上,如果你不希望组件的根元素继承特性设置inheritAttrs: false
        &lt;div name=&apos;hahaha&apos;&gt;
            &lt;div&gt;&lt;/div&gt;
        &lt;/div&gt;
$listeners：一个对象，里面包含所有作用在组件上的监听器，v-on=&apos;$listeners&apos;</code></pre><h2 id="provide-inject"><a href="#provide-inject" class="headerlink" title="provide/inject"></a>provide/inject</h2><p>可以以轻松实现跨级问祖先组件的数据<br>provide：Object | () =&gt; Object,一个对象或返回一个对象的函数<br>inject：Array<string> | { [key: string]: string | Symbol | Object }<br>在父组件中：provide: {name:this.name}  注入依赖<br>在子组件中：inject:[name]</string></p>
<h1 id="插槽-slot"><a href="#插槽-slot" class="headerlink" title="插槽 slot"></a>插槽 slot</h1><p>插槽是一块模板，显示不显示和怎么显示取决于父组件<br>slot写在子组件的那个位置，父组件传过来的模板将显示在那个位置</p>
<h2 id="匿名插槽"><a href="#匿名插槽" class="headerlink" title="匿名插槽"></a>匿名插槽</h2><p>父组件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"father"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>这里是父组件<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tmpl"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span>dada<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span>sasa<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span>fafa<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span>gaga<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>子组件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"child"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>这里是子组件<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="具名插槽"><a href="#具名插槽" class="headerlink" title="具名插槽"></a>具名插槽</h2><p>父组件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"father"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>这里是父组件<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tmpl"</span> <span class="attr">slot</span>=<span class="string">'top'</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span>dada<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span>sasa<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span>fafa<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span>gaga<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			 <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tmpl"</span> <span class="attr">slot</span>=<span class="string">'bootom'</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span>da<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span>sa<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span>fa<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span>ga<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>子组件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"child"</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">'top'</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>这里是子组件<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">'bottom'</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="作用域插槽-带数据的插槽-slot-scope"><a href="#作用域插槽-带数据的插槽-slot-scope" class="headerlink" title="作用域插槽 | 带数据的插槽(slot-scope)"></a>作用域插槽 | 带数据的插槽(slot-scope)</h2><p>在作用域插槽内，父组件可以拿到子组件的数据,子组件可以在slot标签上绑定属性值<br>子组件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">slot</span> <span class="attr">:nickName</span>=<span class="string">"'Tusi'"</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>父组件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">"scope"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123;scope.nickName&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="vnode-virtual-DOM"><a href="#vnode-virtual-DOM" class="headerlink" title="vnode(virtual DOM)"></a>vnode(virtual DOM)</h1><p>js对象：兼容性强，（服务端渲染，原生渲染，手写渲染韩式）；减少操作DOM，页面变化只需修改VNode进行对比，只需要最后一步挂载更新DOM<br>通过render将template模板描述成VNode,然后进行一系列操作之后形成正式DOM进行挂载<br> DOM节点包含：<br>    自身的标签名（div）<br>    自身的属性（id=’app’）<br>    子节点(span)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">"demo"</span> style=<span class="string">"color: red"</span> href=<span class="string">"#"</span>&gt;</span><br><span class="line"> VNode</span><br><span class="line">&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">&#123;</span></span><br><span class="line"><span class="regexp">  tag: 'a',</span></span><br><span class="line"><span class="regexp">  data: &#123;</span></span><br><span class="line"><span class="regexp">    calss: 'demo',</span></span><br><span class="line"><span class="regexp">    attrs: &#123;</span></span><br><span class="line"><span class="regexp">      href: '#'</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    style: &#123;</span></span><br><span class="line"><span class="regexp">      color: 'red'</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;,</span></span><br><span class="line"><span class="regexp">  children: ['VNode']</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">data：存储节点的属性，绑定的事件等</span></span><br><span class="line"><span class="regexp">elm：真实DOM 节点</span></span><br><span class="line"><span class="regexp">context：渲染这个模板的上下文对象</span></span><br><span class="line"><span class="regexp">isStatic：是否是静态节点</span></span><br></pre></td></tr></table></figure>
<h1 id="diff算法"><a href="#diff算法" class="headerlink" title="diff算法"></a>diff算法</h1><p>同级比较：广度优先算法:O(n)<br>本质：找出两个对象（虚拟DOM,vnode）之间的差异，目的是尽可能复用节点<br>vue：先diff得到oldvnode与vnode差异，在patch(补丁)真实DOM<br>   diff算法可以分为两部分：<br>       1. 改变自身属性<br>                遍历 oldVnode 看 newTreeAttr 是否还有对应的属性<br>                如果有并且不相等的，修改对应的属性， 没有的话，直接删除对应的属性<br>                遍历oldVnode, 是否还有对应的属性，没有就新增<br>                2. 改变子节点<br>                 子节点是数组：找出两个数组的差异<br>        旧首（StartIdx），旧尾（EndIdx）<br>        新首，新尾<br>        四种比较方式：<br>            sameVnode(oldStartVnode, newStartVnode)<br>            sameVnode(oldEndVnode,newEndVnode)<br>            sameVnode(oldStartVnode，newEndVnode):oldStartVnode.el跑到oldEndVnode.el的后边了<br>            sameVnode(oldEndVnode，newStartVnode):oldEndVnode.el需要移动到oldStartVnode.el的前边”<br>             oldCh 先遍历完成,则证明 newCh 还有多余节点，需要新增这些节点<br>             newCh 先遍历完成,则证明 oldCh 还有多余节点，需要删除这些节点</p>
<pre><code>    不设key，newCh和oldCh只会进行头尾两端的相互比较，
    设key后，除了头尾两端的比较外，还会从用key生成的对象oldKeyToIdx中查找匹配的节点，所以为节点设置key可以更高效的利用dom。


diff 算法的本质是找出两个对象之间的差异
diff 算法的核心是子节点数组对比,思路是通过 首尾两端对比
key 的作用： 主要是决定节点是否可以复用建立key-index的索引,主要是替代遍历，提升性能 </code></pre><h1 id="模板编译原理"><a href="#模板编译原理" class="headerlink" title="模板编译原理"></a>模板编译原理</h1><p>就是把模板编译成vnode的渲染函数<br>分几步：<br>    1.将模板字符串转转成element ASTS（解析器）；AST（抽象语法树）<br>    2.对AST进行金泰节点标记，主要来做虚拟DOM的渲染优化（优化器）<br>    3.使用element ASTs生成render函数代码字符串（代码生成器）</p>
<p>解释1：一小段一小段的去截取字符串，然后维护一个 stack 用来保存DOM深度，每截取到一段标签的开始就 push 到 stack 中，当所                    有字符串都截取完之后也就解析出了一个完整的 AST。<br>解释2：用递归的方式将所有节点打标记，表示是否是一个 静态节点，然后再次递归一遍把 静态根节点 也标记出来。<br>            优化器的目标是找出那些静态节点并打上标记，而静态节点指的是 DOM 不需要发生变化的节点<br>                        每次重新渲染的时候不需要为静态节点创建新节点<br>                     在 Virtual DOM 中 patching 的过程可以被跳过<br>            优化器的实现原理主要分两步：<br>                1.用递归的方式将所有节点添加 static 属性，标识是不是静态节点<br>                2.标记所有静态根节点<br>解释3：代码生成器（code generator）的原理也是通过递归去拼一个函数执行代码的字符串，递归的过程根据不同的节点类型调用不同的生成方法，如果发现是一颗元素节点就拼一个 _c(tagName, data, children) 的函数调用字符串，然后 data 和 children 也是使用 AST 中的属性去拼字符串。</p>
<h1 id="抽离相同逻辑"><a href="#抽离相同逻辑" class="headerlink" title="抽离相同逻辑"></a>抽离相同逻辑</h1><p>使用mixin（混入）<br>    创建了混入对象之后，我们自定义的方法或者变量可以很轻松的挂载在Vue实例上<br>    局部混入和全局混入<br>    mixin数据不共享，<br>    mixin混入对象值为函数的同名函数选项将会进行递归合并为数组，两个函数都会执行，只不过先执行mixin中的同名函数<br>    mixin混入对象值为对象的同名对象将会进行替换，都优先执行组件内的同名对象，也就是组件内的同名对象将mixin混入对象的同名对象进行覆盖；</p>
<h1 id="vue项目优化"><a href="#vue项目优化" class="headerlink" title="vue项目优化"></a>vue项目优化</h1><p>上线打包</p>
<p>源码编写</p>
<p>用户体验</p>
<p>​    1.引入生产坏境的Vue组件</p>
<p>​    1.vue脚手架，webpack的配置中包含了压缩js，css，html，所以我们单页面越做越大的情况下，首先第一步就是<strong>分包</strong>，整体包大，影响首页加载效率</p>
<p>​    2.<strong>预加载(chrome)</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--DNS prefetch 分析这个页面需要的资源所在的域名，浏览器空闲时提前将这些域名转化为 IP 地址，真正请求资源时就避免了上述这个过程的时间--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">'x-dns-prefetch-control'</span> <span class="attr">content</span>=<span class="string">'on'</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">'dns-prefetch'</span> <span class="attr">href</span>=<span class="string">'http://g-ecx.images-amazon.com'</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">'dns-prefetch'</span> <span class="attr">href</span>=<span class="string">'http://z-ecx.images-amazon.com'</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">'dns-prefetch'</span> <span class="attr">href</span>=<span class="string">'http://ecx.images-amazon.com'</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">'dns-prefetch'</span> <span class="attr">href</span>=<span class="string">'http://completion.amazon.com'</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">'dns-prefetch'</span> <span class="attr">href</span>=<span class="string">'http://fls-na.amazon.com'</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--特定文件预加载--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">'subresource'</span> <span class="attr">href</span>=<span class="string">'critical.js'</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">'subresource'</span> <span class="attr">href</span>=<span class="string">'main.css'</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">'prefetch'</span> <span class="attr">href</span>=<span class="string">'secondary.js'</span>&gt;</span></span><br></pre></td></tr></table></figure>

<pre><code>当资源为以下列表中的资源时，将阻止预渲染操作：
    URL 中包含下载资源
    页面中包含音频、视频
    POST、PUT 和 DELETE 操作的 ajax 请求
    HTTP 认证(Authentication)
    HTTPS 页面
    含恶意软件的页面
    弹窗页面
    占用资源很多的页面
    打开了 chrome developer tools 开发工具</code></pre><ol start="3">
<li><p><strong>vue组件keep-alive</strong></p>
</li>
<li><p><strong>Promise请求</strong></p>
<p>​    减少回调函数</p>
<p>​    串并行处理（一个接口等另一个接口）</p>
<p>​    代码优雅</p>
</li>
<li><p><strong>提取组件css到单独的文件</strong></p>
</li>
</ol>
<p>​        组件内css会以<code>&lt;style&gt;</code>标签的方式通过js动态注入，这有些小小的运行时开销，提取出来更好的进行压缩，        缓存</p>
<ol start="6">
<li><strong>Object.freeze()</strong></li>
</ol>
<p>​        由于 <code>Object.freeze()</code> 会把对象冻结，所以比较适合展示类的场景</p>
<p>​        冻结之后不能向这个对象添加新的属性，不能修改其已有属性的值，不能删除已有属性，以及不能修改该对象已有属性的可枚举性、可配置性、可写性</p>
<p>​        普通的 JS 对象传给 Vue 实例的  <code>data</code> 选项，Vue 将遍历此对象所有的属性，并使用  Object.defineProperty 把这些属性全部转为 getter/setter，这些 getter/setter 对用户来说是不可见的，但是在内部它们让 Vue 追踪依赖，在属性被访问和修改时通知变化。但 Vue 在遇到像 <code>Object.freeze()</code> 这样被设置为不可配置之后的对象属性时，不会为对象加上 setter getter 等数据劫持的方法</p>
<ol start="7">
<li><p>通过<strong>组件懒加载</strong>优化超长应用内容初始化</p>
<p>Vue Lazy Component</p>
<p>无限列表的场景</p>
<p>使用组件懒加载在不可见时只需要渲染一个骨架屏，不需要真正渲染组件</p>
<p>在单页应用中，如果没有应用懒加载，运用webpack打包后的文件将会异常的大，造成进入首页时，需要加载的内容过多，延时过长，不利于用户体验，而运用懒加载则可以将页面进行划分，需要的时候加载页面，可以有效的分担首页所承担的加载压力，减少首页加载用时</p>
</li>
<li><p><strong>服务端渲染（SSR）和预渲染（Prerender）</strong></p>
<p>vue-server-renderer</p>
<p>服务端渲染：发送请求——-&gt;服务端请求数据包含渲染html———&gt;包含首屏html———&gt;用户直接看到html</p>
</li>
</ol>
<h1 id="路由-router"><a href="#路由-router" class="headerlink" title="路由 router"></a>路由 router</h1><p>vue渐进式前端开发框架，为构建SPA（单页面应用），需要引入前端路由：改变路由同时不向后台发出请求</p>
<h2 id="导航解析流程"><a href="#导航解析流程" class="headerlink" title="导航解析流程"></a>导航解析流程</h2><ol>
<li>导航被触发。</li>
<li>在失活的组件里调用 <code>beforeRouteLeave</code> 守卫。</li>
<li>调用全局的 <code>beforeEach</code> 守卫。</li>
<li>在重用的组件里调用 <code>beforeRouteUpdate</code> 守卫 (2.2+)。</li>
<li>在路由配置里调用 <code>beforeEnter</code>。</li>
<li>解析异步路由组件。</li>
<li>在被激活的组件里调用 <code>beforeRouteEnter</code>。</li>
<li>调用全局的 <code>beforeResolve</code> 守卫 (2.5+)。</li>
<li>导航被确认。</li>
<li>调用全局的 <code>afterEach</code> 钩子。</li>
<li>触发 DOM 更新。</li>
<li>用创建好的实例调用 <code>beforeRouteEnter</code> 守卫中传给 <code>next</code> 的回调函数。</li>
</ol>
<h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><p>router路由器</p>
<p>route当前路由：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$route.path <span class="comment">//string 当期那绝对路劲</span></span><br><span class="line">$route.params <span class="comment">// &#123;&#125; 动态路由参数</span></span><br><span class="line">$route.query <span class="comment">// &#123;&#125;  /foo?user=1  ----&gt; $route.query.user == 1</span></span><br><span class="line">$route.hash</span><br><span class="line">$route.fullPath</span><br><span class="line">$route.matched <span class="comment">// 包含当前路由的所有嵌套路径片段的路由记录 ,routes 配置数组中的对象副本,包含children</span></span><br><span class="line">$route.name</span><br><span class="line">$route.redirectedFrom <span class="comment">//重定向，重定向来源的路由的名字</span></span><br></pre></td></tr></table></figure>



<h3 id="动态路由（动态路劲参数）"><a href="#动态路由（动态路劲参数）" class="headerlink" title="动态路由（动态路劲参数）"></a>动态路由（动态路劲参数）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    <span class="comment">// 动态路径参数 以冒号开头</span></span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">'/user/:id'</span>, <span class="attr">component</span>: User &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">'/uer/:id/post/:post_id'</span>&#125; <span class="comment">//可设置多段路径参数</span></span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"> &lt;router-link to=<span class="string">"/user/1"</span>&gt;点击&lt;<span class="regexp">/router-link&gt;</span></span><br><span class="line"><span class="regexp">this.$route.params.id === 1</span></span><br></pre></td></tr></table></figure>



<h3 id="编程式导航"><a href="#编程式导航" class="headerlink" title="编程式导航"></a>编程式导航</h3><p><strong><code>this.$router.push()</code></strong> 向history栈添加一个新纪录，等同于<router-link :to="..."></router-link></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">router.push(<span class="string">'home'</span>)</span><br><span class="line">router.push(&#123;<span class="attr">path</span>:<span class="string">'/home'</span>,<span class="attr">query</span>:&#123;<span class="attr">paln</span>:<span class="string">'private'</span>&#125;&#125;)  <span class="comment">// /register?plan=private</span></span><br><span class="line">router.push(&#123; <span class="attr">name</span>: <span class="string">'user'</span>, <span class="attr">params</span>: &#123; <span class="attr">userId</span>: <span class="string">'123'</span> &#125;&#125;)</span><br><span class="line">router.push(&#123; <span class="attr">path</span>: <span class="string">`/user/<span class="subst">$&#123;userId&#125;</span>`</span> &#125;) <span class="comment">// -&gt; /user/123</span></span><br><span class="line">router.push(&#123; <span class="attr">path</span>: <span class="string">'/user'</span>, <span class="attr">params</span>: &#123; userId &#125;&#125;) <span class="comment">// -&gt; /user</span></span><br></pre></td></tr></table></figure>

<p><strong><code>this.$router.replace()</code></strong> 不会像history中添加新纪录，替换当前history记录，<router-link :to="..." replace></router-link></p>
<p><strong><code>this.$router.go(n)</code></strong></p>
<h3 id="命名视图"><a href="#命名视图" class="headerlink" title="命名视图"></a>命名视图</h3><p>想同时 (同级) 展示多个视图</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-view <span class="class"><span class="keyword">class</span></span>=<span class="string">"view two"</span> name=<span class="string">"a"</span>&gt;&lt;<span class="regexp">/router-view&gt;</span></span><br><span class="line"><span class="regexp">&lt;router-view class="view three" name="b"&gt;&lt;/</span>router-view&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/'</span>,</span><br><span class="line">      components: &#123;</span><br><span class="line">        <span class="keyword">default</span>: Foo,</span><br><span class="line">        a: Bar,</span><br><span class="line">        b: Baz</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="重定向，别名"><a href="#重定向，别名" class="headerlink" title="重定向，别名"></a>重定向，别名</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">'/a'</span>, <span class="attr">redirect</span>: <span class="function"><span class="params">to</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 方法接收 目标路由 作为参数</span></span><br><span class="line">      <span class="comment">// return 重定向的 字符串路径/路径对象</span></span><br><span class="line">    &#125;&#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">'/a'</span>, <span class="attr">redirect</span>: <span class="string">'/b'</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="路由组件传参（props）"><a href="#路由组件传参（props）" class="headerlink" title="路由组件传参（props）"></a>路由组件传参（props）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">'/user/:id'</span>, <span class="attr">component</span>: User, <span class="attr">props</span>: <span class="literal">true</span> &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对于包含命名视图的路由，你必须分别为每个命名视图添加 `props` 选项：</span></span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/user/:id'</span>,</span><br><span class="line">      components: &#123; <span class="attr">default</span>: User, <span class="attr">sidebar</span>: Sidebar &#125;,</span><br><span class="line">      props: &#123; <span class="attr">default</span>: <span class="literal">true</span>, <span class="attr">sidebar</span>: <span class="literal">false</span> &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">     &#123; <span class="attr">path</span>: <span class="string">'/search'</span>,</span><br><span class="line">      component: SearchUser,</span><br><span class="line">      props: <span class="function">(<span class="params">route</span>) =&gt;</span> (&#123; <span class="attr">query</span>: route.query.q &#125;) &#125; <span class="comment">///search?q=vue</span></span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="导航守卫"><a href="#导航守卫" class="headerlink" title="导航守卫"></a>导航守卫</h3><p><strong>参数或查询的改变并不会触发进入/离开的导航守卫</strong>，可通过watch $route对象来应对，或者beforeRouteUpdate</p>
<ol>
<li><h4 id="全局前置守卫"><a href="#全局前置守卫" class="headerlink" title="全局前置守卫"></a>全局前置守卫</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">router.beforEach(<span class="function">(<span class="params">to,<span class="keyword">from</span>,next</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//遍历元信息是否身份验证，是否登录</span></span><br><span class="line"> <span class="keyword">if</span> (to.matched.some(<span class="function"><span class="params">record</span> =&gt;</span> record.meta.requiresAuth)) &#123;</span><br><span class="line">     </span><br><span class="line"> &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//next(),一定调用该方法resolve这个钩子，进行管道中的下一个钩子</span></span><br><span class="line"><span class="comment">// next(false) 中断当前导航</span></span><br><span class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (to.name !== <span class="string">'Login'</span> &amp;&amp; !isAuthenticated) next(&#123; <span class="attr">name</span>: <span class="string">'Login'</span> &#125;)</span><br><span class="line">  <span class="comment">// 如果用户未能验证身份，则 `next` 会被调用两次</span></span><br><span class="line">  <span class="keyword">else</span> next()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><h4 id="全局解析守卫"><a href="#全局解析守卫" class="headerlink" title="全局解析守卫"></a>全局解析守卫</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">router.beforeResolve() <span class="comment">// 导航被确认之前</span></span><br></pre></td></tr></table></figure>
</li>
<li><h4 id="全局后置钩子"><a href="#全局后置钩子" class="headerlink" title="全局后置钩子"></a>全局后置钩子</h4><p>不会改变导航本身，不接受next()</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">router.afterEach(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><h4 id="路由独享的守卫"><a href="#路由独享的守卫" class="headerlink" title="路由独享的守卫"></a>路由独享的守卫</h4><p>可以在路由上直接定义beforEnter()</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/foo'</span>,</span><br><span class="line">      component: Foo,</span><br><span class="line">      beforeEnter: <span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><h4 id="组件内守卫"><a href="#组件内守卫" class="headerlink" title="组件内守卫"></a>组件内守卫</h4><ul>
<li><p><code>beforeRouteEnter</code></p>
</li>
<li><p><code>beforeRouteUpdate</code> (2.2 新增)</p>
</li>
<li><p><code>beforeRouteLeave</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Foo = &#123;</span><br><span class="line">  template: <span class="string">`...`</span>,</span><br><span class="line">  beforeRouteEnter (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">    <span class="comment">// 在渲染该组件的对应路由被 confirm 前调用</span></span><br><span class="line">    <span class="comment">// 不！能！获取组件实例 `this`，可以传入一个回调</span></span><br><span class="line">      next( <span class="function"><span class="params">vm</span> =&gt;</span> &#123;</span><br><span class="line">    	<span class="comment">// 通过 `vm` 访问组件实例</span></span><br><span class="line">  	  &#125;)</span><br><span class="line">    <span class="comment">// 因为当守卫执行前，组件实例还没被创建</span></span><br><span class="line">  &#125;,</span><br><span class="line">  beforeRouteUpdate (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">    <span class="comment">// 在当前路由改变，但是该组件被复用时调用</span></span><br><span class="line">    <span class="comment">// 举例来说，对于一个带有动态参数的路径 /foo/:id，在 /foo/1 和 /foo/2 之间跳转的时候，</span></span><br><span class="line">    <span class="comment">// 由于会渲染同样的 Foo 组件，因此组件实例会被复用。而这个钩子就会在这个情况下被调用。</span></span><br><span class="line">    <span class="comment">// 可以访问组件实例 `this`</span></span><br><span class="line">  &#125;,</span><br><span class="line">  beforeRouteLeave (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">    <span class="comment">// 导航离开该组件的对应路由时调用</span></span><br><span class="line">    <span class="comment">// 可以访问组件实例 `this`</span></span><br><span class="line">    <span class="comment">// 通常用来禁止用户在还未保存修改前突然离开,通过next(flase)取消</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ol>
<h3 id="路由元信息（meta）"><a href="#路由元信息（meta）" class="headerlink" title="路由元信息（meta）"></a>路由元信息（meta）</h3><p>vue-router路由元信息说白了就是通过meta对象中的一些属性来判断当前路由是否需要进一步处理</p>
<p>在定义路由时定义一个需要验证的meta信息 meta: {requiresAuth: true}</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/foo'</span>,</span><br><span class="line">      component: Foo,</span><br><span class="line">      children: [</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">'bar'</span>,</span><br><span class="line">          component: Bar,</span><br><span class="line">          <span class="comment">// a meta field</span></span><br><span class="line">          meta: &#123; <span class="attr">requiresAuth</span>: <span class="literal">true</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="路由懒加载"><a href="#路由懒加载" class="headerlink" title="路由懒加载"></a>路由懒加载</h3><h2 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mode: <span class="string">'hash'</span>,</span><br></pre></td></tr></table></figure>

<p>地址栏URL中有#，hash虽然在URL中，但不影响HTTP请求，改变 hash 不会重新加载页面。</p>
<p>hash模式背后的原理是onhashchange事件,可以在window对象上监听这个事件:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onhashchange = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(event.oldURL, event.newURL)</span><br><span class="line">	<span class="keyword">let</span> hash = location.hash.slice(<span class="number">1</span>)</span><br><span class="line">	<span class="built_in">document</span>.body.style.color = hash</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="history"><a href="#history" class="headerlink" title="history"></a>history</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mode: <span class="string">'history'</span>,</span><br></pre></td></tr></table></figure>

<p>利用HTML5 History Interface中增加的pushStste(),repalceStste(),此方法应用于浏览器历史记录栈</p>
<p>1.切换历史状态</p>
<p>包括：back()，go()，forward()前进</p>
<p>2.修改历史状态</p>
<p>pushState(stateObj,title,url)，</p>
<p>replaceState(stateObj,title,url)</p>
<p>怕刷新，f5，刷新要请求服务器</p>
<p>企业微信页面开发，如果使用history模式，从某个页面路由到另一个页面时，安卓手机（Android6.2以下）微信会认为重新打开了一个新的页面，导致签名失败，需要重新注入配置信息。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/vue/" rel="tag"># vue</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/05/13/%E5%88%9D%E6%8E%A2weex/" rel="next" title="初探weex">
                <i class="fa fa-chevron-left"></i> 初探weex
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/06/17/css%E5%8A%A8%E7%94%BB/" rel="prev" title="前端动画总结">
                前端动画总结 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/header.jpg"
                alt="小飒" />
            
              <p class="site-author-name" itemprop="name">小飒</p>
              <p class="site-description motion-element" itemprop="description">工作 生活 学习</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive%20%20%20%20%20%20%20%20%20%20/%E5%BD%92%E6%A1%A3">
              
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#MVC"><span class="nav-number">1.</span> <span class="nav-text">MVC</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MVVM"><span class="nav-number">2.</span> <span class="nav-text">MVVM</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#渲染方式"><span class="nav-number">3.</span> <span class="nav-text">渲染方式</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#异步更新DOM"><span class="nav-number">4.</span> <span class="nav-text">异步更新DOM</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#事件循环机制"><span class="nav-number">4.1.</span> <span class="nav-text">事件循环机制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#微任务"><span class="nav-number">4.1.1.</span> <span class="nav-text">微任务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#宏任务"><span class="nav-number">4.1.2.</span> <span class="nav-text">宏任务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nextTick原理"><span class="nav-number">4.1.3.</span> <span class="nav-text">nextTick原理</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#动态和异步组件"><span class="nav-number">5.</span> <span class="nav-text">动态和异步组件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#动态组件"><span class="nav-number">5.1.</span> <span class="nav-text">动态组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#keep-alive"><span class="nav-number">5.2.</span> <span class="nav-text">keep-alive</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#异步组件"><span class="nav-number">5.3.</span> <span class="nav-text">异步组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#按需加载"><span class="nav-number">5.4.</span> <span class="nav-text">按需加载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#webpack代码分割"><span class="nav-number">5.5.</span> <span class="nav-text">webpack代码分割</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">5.6.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#生命周期"><span class="nav-number">6.</span> <span class="nav-text">生命周期</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#"><span class="nav-number">6.1.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ajax在那个生命周期"><span class="nav-number">6.2.</span> <span class="nav-text">ajax在那个生命周期</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#父子组件生命周期调用顺序"><span class="nav-number">6.3.</span> <span class="nav-text">父子组件生命周期调用顺序</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#计算属性，侦听属性"><span class="nav-number">7.</span> <span class="nav-text">计算属性，侦听属性</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#计算属性"><span class="nav-number">7.1.</span> <span class="nav-text">计算属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#侦听属性"><span class="nav-number">7.2.</span> <span class="nav-text">侦听属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#两者区别"><span class="nav-number">7.3.</span> <span class="nav-text">两者区别</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#事件绑定原理"><span class="nav-number">8.</span> <span class="nav-text">事件绑定原理</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用-v-html指令问题"><span class="nav-number">9.</span> <span class="nav-text">使用 v-html指令问题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#v-if-v-for"><span class="nav-number">10.</span> <span class="nav-text">v-if v-for</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#两者不可一起使用"><span class="nav-number">10.1.</span> <span class="nav-text">两者不可一起使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#v-for-key"><span class="nav-number">10.2.</span> <span class="nav-text">v-for key</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#v-model"><span class="nav-number">11.</span> <span class="nav-text">v-model</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#组件之间的通信"><span class="nav-number">12.</span> <span class="nav-text">组件之间的通信</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#props"><span class="nav-number">12.1.</span> <span class="nav-text">props</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#emit"><span class="nav-number">12.2.</span> <span class="nav-text">$emit</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#emit-on"><span class="nav-number">12.3.</span> <span class="nav-text">$emit&#x2F;$on</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#vuex"><span class="nav-number">12.4.</span> <span class="nav-text">vuex</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#原理"><span class="nav-number">12.5.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#parent-children"><span class="nav-number">12.6.</span> <span class="nav-text">$parent &#x2F; $children</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#attrs-listeners"><span class="nav-number">12.7.</span> <span class="nav-text">$attrs&#x2F;$listeners</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#provide-inject"><span class="nav-number">12.8.</span> <span class="nav-text">provide&#x2F;inject</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#插槽-slot"><span class="nav-number">13.</span> <span class="nav-text">插槽 slot</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#匿名插槽"><span class="nav-number">13.1.</span> <span class="nav-text">匿名插槽</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#具名插槽"><span class="nav-number">13.2.</span> <span class="nav-text">具名插槽</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#作用域插槽-带数据的插槽-slot-scope"><span class="nav-number">13.3.</span> <span class="nav-text">作用域插槽 | 带数据的插槽(slot-scope)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#vnode-virtual-DOM"><span class="nav-number">14.</span> <span class="nav-text">vnode(virtual DOM)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#diff算法"><span class="nav-number">15.</span> <span class="nav-text">diff算法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#模板编译原理"><span class="nav-number">16.</span> <span class="nav-text">模板编译原理</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#抽离相同逻辑"><span class="nav-number">17.</span> <span class="nav-text">抽离相同逻辑</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#vue项目优化"><span class="nav-number">18.</span> <span class="nav-text">vue项目优化</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#路由-router"><span class="nav-number">19.</span> <span class="nav-text">路由 router</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#导航解析流程"><span class="nav-number">19.1.</span> <span class="nav-text">导航解析流程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基础"><span class="nav-number">19.1.1.</span> <span class="nav-text">基础</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#动态路由（动态路劲参数）"><span class="nav-number">19.1.2.</span> <span class="nav-text">动态路由（动态路劲参数）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编程式导航"><span class="nav-number">19.1.3.</span> <span class="nav-text">编程式导航</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#命名视图"><span class="nav-number">19.1.4.</span> <span class="nav-text">命名视图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重定向，别名"><span class="nav-number">19.1.5.</span> <span class="nav-text">重定向，别名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#路由组件传参（props）"><span class="nav-number">19.1.6.</span> <span class="nav-text">路由组件传参（props）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#导航守卫"><span class="nav-number">19.1.7.</span> <span class="nav-text">导航守卫</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#全局前置守卫"><span class="nav-number">19.1.7.1.</span> <span class="nav-text">全局前置守卫</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#全局解析守卫"><span class="nav-number">19.1.7.2.</span> <span class="nav-text">全局解析守卫</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#全局后置钩子"><span class="nav-number">19.1.7.3.</span> <span class="nav-text">全局后置钩子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#路由独享的守卫"><span class="nav-number">19.1.7.4.</span> <span class="nav-text">路由独享的守卫</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#组件内守卫"><span class="nav-number">19.1.7.5.</span> <span class="nav-text">组件内守卫</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#路由元信息（meta）"><span class="nav-number">19.1.8.</span> <span class="nav-text">路由元信息（meta）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#路由懒加载"><span class="nav-number">19.1.9.</span> <span class="nav-text">路由懒加载</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hash"><span class="nav-number">19.2.</span> <span class="nav-text">hash</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#history"><span class="nav-number">19.3.</span> <span class="nav-text">history</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">小飒</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
